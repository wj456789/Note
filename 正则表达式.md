# 正则表达式

| 构造                                           | 匹配                                                         |
| ---------------------------------------------- | ------------------------------------------------------------ |
|                                                |                                                              |
| 字符                                           |                                                              |
| *x*                                            | 字符 *x*                                                     |
| `\\`                                           | 反斜线字符                                                   |
| `\0`*n*                                        | 带有八进制值 `0` 的字符 *n* (0 `<=` *n* `<=` 7)              |
| `\0`*nn*                                       | 带有八进制值 `0` 的字符 *nn* (0 `<=` *n* `<=` 7)             |
| `\0`*mnn*                                      | 带有八进制值 `0` 的字符 *mnn*（0 `<=` *m* `<=` 3、0 `<=` *n* `<=` 7） |
| `\x`*hh*                                       | 带有十六进制值 `0x` 的字符 *hh*                              |
| `\u`*hhhh*                                     | 带有十六进制值 `0x` 的字符 *hhhh*                            |
| `\t`                                           | 制表符 (`'\u0009'`)                                          |
| `\n`                                           | 新行（换行）符 (`'\u000A'`)                                  |
| `\r`                                           | 回车符 (`'\u000D'`)                                          |
| `\f`                                           | 换页符 (`'\u000C'`)                                          |
| `\a`                                           | 报警 (bell) 符 (`'\u0007'`)                                  |
| `\e`                                           | 转义符 (`'\u001B'`)                                          |
| `\c`*x*                                        | 对应于 *x* 的控制符                                          |
|                                                |                                                              |
| 字符类                                         |                                                              |
| `[abc]`                                        | `a`、`b` 或 `c`（简单类）                                    |
| `[^abc]`                                       | 任何字符，除了 `a`、`b` 或 `c`（否定）                       |
| `[a-zA-Z]`                                     | `a` 到 `z` 或 `A` 到 `Z`，两头的字母包括在内（范围）         |
| `[a-d[m-p]]`                                   | `a` 到 `d` 或 `m` 到 `p`：`[a-dm-p]`（并集）                 |
| `[a-z&&[def]]`                                 | `d`、`e` 或 `f`（交集）                                      |
| `[a-z&&[^bc]]`                                 | `a` 到 `z`，除了 `b` 和 `c`：`[ad-z]`（减去）                |
| `[a-z&&[^m-p]]`                                | `a` 到 `z`，而非 `m` 到 `p`：`[a-lq-z]`（减去）              |
|                                                |                                                              |
| 预定义字符类                                   |                                                              |
| `.`                                            | 任何字符（与行结束符可能匹配也可能不匹配）                   |
| `\d`                                           | 数字：`[0-9]`                                                |
| `\D`                                           | 非数字： `[^0-9]`                                            |
| `\s`                                           | 空白字符：`[ \t\n\x0B\f\r]`                                  |
| `\S`                                           | 非空白字符：`[^\s]`                                          |
| `\w`                                           | 单词字符：`[a-zA-Z_0-9]`                                     |
| `\W`                                           | 非单词字符：`[^\w]`                                          |
|                                                |                                                              |
| POSIX 字符类（仅 US-ASCII）                    |                                                              |
| `\p{Lower}`                                    | 小写字母字符：`[a-z]`                                        |
| `\p{Upper}`                                    | 大写字母字符：`[A-Z]`                                        |
| `\p{ASCII}`                                    | 所有 ASCII：`[\x00-\x7F]`                                    |
| `\p{Alpha}`                                    | 字母字符：`[\p{Lower}\p{Upper}]`                             |
| `\p{Digit}`                                    | 十进制数字：`[0-9]`                                          |
| `\p{Alnum}`                                    | 字母数字字符：`[\p{Alpha}\p{Digit}]`                         |
| `\p{Punct}`                                    | 标点符号：`!"#$%&'()*+,-.\:;<=>?@[\]^_`{|}~`                 |
| `\p{Graph}`                                    | 可见字符：`[\p{Alnum}\p{Punct}]`                             |
| `\p{Print}`                                    | 可打印字符：`[\p{Graph}\x20]`                                |
| `\p{Blank}`                                    | 空格或制表符：`[ \t]`                                        |
| `\p{Cntrl}`                                    | 控制字符：`[\x00-\x1F\x7F]`                                  |
| `\p{XDigit}`                                   | 十六进制数字：`[0-9a-fA-F]`                                  |
| `\p{Space}`                                    | 空白字符：`[ \t\n\x0B\f\r]`                                  |
|                                                |                                                              |
| java.lang.Character 类（简单的 java 字符类型） |                                                              |
| `\p{javaLowerCase}`                            | 等效于 java.lang.Character.isLowerCase()                     |
| `\p{javaUpperCase}`                            | 等效于 java.lang.Character.isUpperCase()                     |
| `\p{javaWhitespace}`                           | 等效于 java.lang.Character.isWhitespace()                    |
| `\p{javaMirrored}`                             | 等效于 java.lang.Character.isMirrored()                      |
|                                                |                                                              |
| Unicode 块和类别的类                           |                                                              |
| `\p{InGreek}`                                  | Greek 块（简单块）中的字符                                   |
| `\p{Lu}`                                       | 大写字母（简单类别）                                         |
| `\p{Sc}`                                       | 货币符号                                                     |
| `\P{InGreek}`                                  | 所有字符，Greek 块中的除外（否定）                           |
| `[\p{L}&&[^\p{Lu}]] `                          | 所有字母，大写字母除外（减去）                               |
|                                                |                                                              |
| 边界匹配器                                     |                                                              |
| `^`                                            | 行的开头                                                     |
| `$`                                            | 行的结尾                                                     |
| `\b`                                           | 单词边界                                                     |
| `\B`                                           | 非单词边界                                                   |
| `\A`                                           | 输入的开头                                                   |
| `\G`                                           | 上一个匹配的结尾                                             |
| `\Z`                                           | 输入的结尾，仅用于最后的结束符（如果有的话）                 |
| `\z`                                           | 输入的结尾                                                   |
|                                                |                                                              |
| Greedy 数量词                                  |                                                              |
| *X*`?`                                         | *X*，一次或一次也没有                                        |
| *X*`*`                                         | *X*，零次或多次                                              |
| *X*`+`                                         | *X*，一次或多次                                              |
| *X*`{`*n*`}`                                   | *X*，恰好 *n* 次                                             |
| *X*`{`*n*`,}`                                  | *X*，至少 *n* 次                                             |
| *X*`{`*n*`,`*m*`}`                             | *X*，至少 *n* 次，但是不超过 *m* 次                          |
|                                                |                                                              |
| Reluctant 数量词                               |                                                              |
| *X*`??`                                        | *X*，一次或一次也没有                                        |
| *X*`*?`                                        | *X*，零次或多次                                              |
| *X*`+?`                                        | *X*，一次或多次                                              |
| *X*`{`*n*`}?`                                  | *X*，恰好 *n* 次                                             |
| *X*`{`*n*`,}?`                                 | *X*，至少 *n* 次                                             |
| *X*`{`*n*`,`*m*`}?`                            | *X*，至少 *n* 次，但是不超过 *m* 次                          |
|                                                |                                                              |
| Possessive 数量词                              |                                                              |
| *X*`?+`                                        | *X*，一次或一次也没有                                        |
| *X*`*+`                                        | *X*，零次或多次                                              |
| *X*`++`                                        | *X*，一次或多次                                              |
| *X*`{`*n*`}+`                                  | *X*，恰好 *n* 次                                             |
| *X*`{`*n*`,}+`                                 | *X*，至少 *n* 次                                             |
| *X*`{`*n*`,`*m*`}+`                            | *X*，至少 *n* 次，但是不超过 *m* 次                          |
|                                                |                                                              |
| Logical 运算符                                 |                                                              |
| *XY*                                           | *X* 后跟 *Y*                                                 |
| *X*`|`*Y*                                      | *X* 或 *Y*                                                   |
| `(`*X*`)`                                      | X，作为捕获组                                                |
|                                                |                                                              |
| Back 引用                                      |                                                              |
| `\`*n*                                         | 任何匹配的 *n*th 捕获组                                      |
|                                                |                                                              |
| 引用                                           |                                                              |
| `\`                                            | Nothing，但是引用以下字符                                    |
| `\Q`                                           | Nothing，但是引用所有字符，直到 `\E`                         |
| `\E`                                           | Nothing，但是结束从 `\Q` 开始的引用                          |
|                                                |                                                              |
| 特殊构造（非捕获）                             |                                                              |
| `(?:`*X*`)`                                    | *X*，作为非捕获组                                            |
| `(?idmsux-idmsux) `                            | Nothing，但是将匹配标志i d m s u x on - off                  |
| `(?idmsux-idmsux:`*X*`)`                       | *X*，作为带有给定标志 i d m s u x on - off                   |
| `(?=`*X*`)`                                    | *X*，通过零宽度的正 lookahead                                |
| `(?!`*X*`)`                                    | *X*，通过零宽度的负 lookahead                                |
| `(?<=`*X*`)`                                   | *X*，通过零宽度的正 lookbehind                               |
| `(?<!`*X*`)`                                   | *X*，通过零宽度的负 lookbehind                               |
| `(?>`*X*`)`                                    | *X*，作为独立的非捕获组                                      |

参考：[Java学习笔记之Pattern类的用法详解(正则表达式)](https://www.cnblogs.com/sparkbj/articles/6207103.html)

## 元字符

### (?=pattern)

正向肯定预查，在字符串开始处匹配pattern。这是一个非获取匹配，该匹配不需要获取供以后使用，需要和其他的获取匹配配合使用，通过获取匹配获取字符串，字符串开始处匹配pattern。

```java
System.out.println(Pattern.matches("(?=95|98|NT|2000)[\\s\\S]*","2000YVTYTV"));
System.out.println(Pattern.matches("(?=95|98|NT|2000)[\\s\\S]*","AS2000YVTYTV"));
输出：
true
false
```

### (?<=pattern)

与正向肯定预查类似，只是方向相反，在字符串末尾处匹配pattern

```java
System.out.println(Pattern.matches("[\\s\\S]*(?<=95|98|NT|2000)","YVTYTV2000"));
System.out.println(Pattern.matches("[\\s\\S]*(?<=95|98|NT|2000)","AS2000YV"));
输出：
true
false
```

## Pattern预编译

在频繁调用的场景（例如在方法体内或循环语句中）中，定义Pattern会导致重复预编译正则表达式，降低程序执行效率。另外，对于JDK中的某些API会接受字符串格式的正则表达式作为参数，如`String.replaceAll`、`String.split`等，对于这些API的使用也要考虑性能问题。 

```java
【反例】
public class RegexExp {
    // 该方法被频繁调用
    private boolean isLowerCase(String str) {
        Pattern pattern = Pattern.compile("[a-z]+");
        if (pattern.matcher(str).find()) {
            return true;
        }
        return false;
    }
}
【正例】
public class RegexExp {
    private static final Pattern CHARSET_REG = Pattern.compile("[a-z]+");
    // 该方法被频繁调用
    private boolean isLowerCase(String str) {
        if (CHARSET_REG.matcher(str).find()) {
            return true;
        }
        return false;
    }
}

【反例】
public void doSomething() {
    ...
    for(String temp : strList) {
        temp.replaceAll(regex, "XXX");
        ...
     }
     ...
}
【正例】
public void doSomething() {
    ...
    Pattern pattern = Pattern.compile(regex);  
    for(String temp : strList) {
        pattern.matcher(temp).replaceAll("XXX");
        ...
     }
     ...
}
```



## 转义

常规字符串只转义一次，正则表达式中的\转义两次，并且每次转义中每个字符只能使用一次

常规字符串中`\\\\`经过转义后为`\\`

正则表达式中`\\\\`第一次转义,前两个`\\`转义为`\`,后两个`\\`也转义为`\`,第二次`\\`再转义为`\`

反过来`\`匹配正则表达式，第一次匹配`\\`,第二次匹配`\\\\`,最后正则表达式为`\\\\`

`\\\\`-->`\\`-->`\`

`\\d`-->`\d`-->`(任意一个数字)`

`\\\\\\d`-->`\\\d`-->`\(任意一个数字)`

## 常用正则表达式

### 密码

```java
//至少一个数字，至少一个小写字母，至少一个大写字母，至少一个特殊字符,位数在8-16位
System.out.println(Pattern.matches(
    	"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*?-])[\\S\\s]{8,16}$","5680dasA@das"));
```

### 数字范围        

```java
//匹配1-255之间的正整数
System.out.println(Pattern.matches("^(25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|[1-9])$","253"));
```

### IP和端口

```java
//IPv4的地址格式，总长度 32位=4段*8位，每段之间用.分割， 每段都是0-255之间的十进制数值
System.out.println("10.45.168.74".matches("^((25[0-5]|2[0-4]\\d|((1\\d{2})|([1-9]?\\d)))\\.){3}(25[0-5]|2[0-4]\\d|((1\\d{2})|([1-9]?\\d)))$"));
//端口号0-65535
System.out.println("8080".matches("^([0-9]|[1-9]\\d|[1-9]\\d{2}|[1-9]\\d{3}|[1-5]\\d{4}|6[0-4]\\d{3}|65[0-4]\\d{2}|655[0-2]\\d|6553[0-5])$"));
```

